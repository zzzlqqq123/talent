<template>
  <div class="test-intro-page">
    <div class="container">
      <div class="intro-header">
        <h1 class="title gradient-text">ä¸ªäººå¤©èµ‹æµ‹è¯•</h1>
        <p class="subtitle">å‘ç°ä½ çš„ç‹¬ç‰¹å¤©èµ‹ï¼Œæ‰¾åˆ°æœ€é€‚åˆçš„å‘å±•æ–¹å‘</p>
      </div>

      <div class="intro-content">
        <!-- æµ‹è¯•è¯´æ˜å¡ç‰‡ -->
        <div class="info-card glass-card">
          <div class="card-header">
            <span class="header-icon">ğŸ“‹</span>
            <span>æµ‹è¯•è¯´æ˜</span>
          </div>
          <div class="info-list">
            <div class="info-item">
              <el-icon class="item-icon"><Clock /></el-icon>
              <div class="item-content">
                <strong>æµ‹è¯•æ—¶é•¿ï¼š</strong>çº¦15-20åˆ†é’Ÿ
              </div>
            </div>
            <div class="info-item">
              <el-icon class="item-icon"><Document /></el-icon>
              <div class="item-content">
                <strong>é¢˜ç›®æ•°é‡ï¼š</strong>{{ questionStats.total || 65 }}é“é¢˜ç›®
              </div>
            </div>
            <div class="info-item">
              <el-icon class="item-icon"><Warning /></el-icon>
              <div class="item-content">
                <strong>æ³¨æ„äº‹é¡¹ï¼š</strong>è¯·æ ¹æ®çœŸå®æ„Ÿå—ä½œç­”ï¼Œæ²¡æœ‰å¯¹é”™ä¹‹åˆ†
              </div>
            </div>
            <div class="info-item">
              <el-icon class="item-icon"><Check /></el-icon>
              <div class="item-content">
                <strong>å®Œæˆåï¼š</strong>å°†è·å¾—è¯¦ç»†çš„å¤©èµ‹åˆ†ææŠ¥å‘Š
              </div>
            </div>
          </div>
        </div>

        <!-- æµ‹è¯•ç»´åº¦å¡ç‰‡ -->
        <div class="dimension-card glass-card">
          <div class="card-header">
            <span class="header-icon">ğŸ¯</span>
            <span>æµ‹è¯•ç»´åº¦</span>
          </div>
          <div class="dimension-list">
            <div class="dimension-item">
              <div class="dimension-icon">ğŸ§ </div>
              <div class="dimension-info">
                <h3>è®¤çŸ¥èƒ½åŠ›</h3>
                <p>é€»è¾‘æ€ç»´ã€å­¦ä¹ èƒ½åŠ›ã€åˆ†æèƒ½åŠ›ã€è®°å¿†åŠ›ç­‰</p>
                <el-tag size="small" type="primary">{{ questionStats.byDimension?.cognitive || 20 }}é¢˜</el-tag>
              </div>
            </div>
            <div class="dimension-item">
              <div class="dimension-icon">ğŸ’¡</div>
              <div class="dimension-info">
                <h3>åˆ›é€ åŠ›</h3>
                <p>åˆ›æ–°æ€ç»´ã€æƒ³è±¡åŠ›ã€è‰ºæœ¯æ„ŸçŸ¥ã€çªç ´æ€§æ€ç»´ç­‰</p>
                <el-tag size="small" type="success">{{ questionStats.byDimension?.creativity || 15 }}é¢˜</el-tag>
              </div>
            </div>
            <div class="dimension-item">
              <div class="dimension-icon">â¤ï¸</div>
              <div class="dimension-info">
                <h3>æƒ…æ„Ÿæ™ºèƒ½</h3>
                <p>æƒ…ç»ªç®¡ç†ã€åŒç†å¿ƒã€äººé™…å…³ç³»ã€ç¤¾äº¤èƒ½åŠ›ç­‰</p>
                <el-tag size="small" type="warning">{{ questionStats.byDimension?.emotional || 15 }}é¢˜</el-tag>
              </div>
            </div>
            <div class="dimension-item">
              <div class="dimension-icon">âš¡</div>
              <div class="dimension-info">
                <h3>å®è·µèƒ½åŠ›</h3>
                <p>æ‰§è¡ŒåŠ›ã€æ—¶é—´ç®¡ç†ã€é—®é¢˜è§£å†³ã€é¢†å¯¼åŠ›ç­‰</p>
                <el-tag size="small" type="danger">{{ questionStats.byDimension?.practical || 15 }}é¢˜</el-tag>
              </div>
            </div>
          </div>
        </div>

        <!-- ç­”é¢˜å»ºè®®å¡ç‰‡ -->
        <div class="tips-card glass-card">
          <div class="card-header">
            <span class="header-icon">ğŸ’¡</span>
            <span>ç­”é¢˜å»ºè®®</span>
          </div>
          <ul class="tips-list">
            <li>é€‰æ‹©å®‰é™çš„ç¯å¢ƒï¼Œç¡®ä¿ä¸è¢«æ‰“æ‰°</li>
            <li>æ ¹æ®ç¬¬ä¸€ç›´è§‰ä½œç­”ï¼Œä¸è¦è¿‡åº¦æ€è€ƒ</li>
            <li>è¯šå®å›ç­”ï¼Œè¿™æ ·æ‰èƒ½è·å¾—å‡†ç¡®çš„ç»“æœ</li>
            <li>æµ‹è¯•è¿‡ç¨‹ä¸­å¯ä»¥æš‚åœï¼Œç­”æ¡ˆä¼šè‡ªåŠ¨ä¿å­˜</li>
            <li>å®Œæˆæ‰€æœ‰é¢˜ç›®åï¼Œå°†ç”Ÿæˆä¸“å±æŠ¥å‘Š</li>
          </ul>
        </div>

        <div class="action-buttons">
          <el-button 
            type="primary" 
            size="large" 
            class="start-test-btn"
            :loading="loading"
            @click="handleStartTest"
          >
            å¼€å§‹æµ‹è¯•
          </el-button>
          <el-button 
            size="large" 
            class="back-btn"
            @click="$router.push('/')"
          >
            è¿”å›é¦–é¡µ
          </el-button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Clock, Document, Warning, Check } from '@element-plus/icons-vue'
import { getQuestionStats } from '@/api/test'
import { useTestStore } from '@/store/modules/test'

const router = useRouter()
const testStore = useTestStore()

const loading = ref(false)
const questionStats = ref<any>({
  total: 65,
  byDimension: {
    cognitive: 20,
    creativity: 15,
    emotional: 15,
    practical: 15
  }
})

// è·å–é¢˜ç›®ç»Ÿè®¡ä¿¡æ¯
const fetchQuestionStats = async () => {
  try {
    const res = await getQuestionStats()
    if (res.success && res.data) {
      questionStats.value = res.data
    }
  } catch (error) {
    console.error('è·å–é¢˜ç›®ç»Ÿè®¡å¤±è´¥:', error)
  }
}

// å¼€å§‹æµ‹è¯•
const handleStartTest = async () => {
  // æ£€æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„æµ‹è¯•
  if (testStore.isInProgress) {
    try {
      await ElMessageBox.confirm(
        'æ£€æµ‹åˆ°æ‚¨æœ‰æœªå®Œæˆçš„æµ‹è¯•ï¼Œæ˜¯å¦ç»§ç»­ä¸Šæ¬¡çš„æµ‹è¯•ï¼Ÿ',
        'æç¤º',
        {
          confirmButtonText: 'ç»§ç»­æµ‹è¯•',
          cancelButtonText: 'é‡æ–°å¼€å§‹',
          type: 'warning'
        }
      )
      // ç»§ç»­ä¸Šæ¬¡çš„æµ‹è¯•
      router.push(`/test/questions/${testStore.currentPage}`)
      return
    } catch {
      // ç”¨æˆ·é€‰æ‹©é‡æ–°å¼€å§‹
      testStore.resetTest()
    }
  }

  loading.value = true
  try {
    // åˆå§‹åŒ–æµ‹è¯•
    await testStore.initTest()
    ElMessage.success('æµ‹è¯•å·²å¼€å§‹ï¼Œç¥æ‚¨ç­”é¢˜æ„‰å¿«ï¼')
    // è·³è½¬åˆ°ç­”é¢˜é¡µé¢ï¼ˆç¬¬1é¡µï¼‰
    router.push('/test/questions/1')
  } catch (error: any) {
    console.error('å¼€å§‹æµ‹è¯•å¤±è´¥:', error)
    ElMessage.error(error.message || 'å¼€å§‹æµ‹è¯•å¤±è´¥ï¼Œè¯·é‡è¯•')
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  fetchQuestionStats()
  // å°è¯•æ¢å¤æµ‹è¯•çŠ¶æ€
  testStore.restoreFromLocalStorage()
})
</script>

<style scoped>
.test-intro-page {
  min-height: 100vh;
  background: radial-gradient(circle at top right, #fdf2f8, #eef2ff, #f0f9ff);
  padding: 60px 20px 40px;
}

.container {
  max-width: 1000px;
  margin: 0 auto;
}

.intro-header {
  text-align: center;
  margin-bottom: 56px;
}

.title {
  font-size: 48px;
  font-weight: 800;
  margin-bottom: 20px;
  letter-spacing: -1px;
}

.subtitle {
  font-size: 20px;
  color: #6b7280;
  font-weight: 500;
}

.intro-content {
  display: flex;
  flex-direction: column;
  gap: 32px;
}

/* å¡ç‰‡é€šç”¨æ ·å¼ */
.info-card,
.dimension-card,
.tips-card {
  padding: 48px;
  transition: all 0.3s ease;
}

.info-card:hover,
.dimension-card:hover,
.tips-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(102, 126, 234, 0.15);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 24px;
  font-weight: 700;
  margin-bottom: 32px;
  color: #1f2937;
}

.header-icon {
  font-size: 32px;
}

/* ä¿¡æ¯åˆ—è¡¨ */
.info-list {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 16px;
  background: rgba(255, 255, 255, 0.5);
  border-radius: 1rem;
  transition: all 0.3s ease;
}

.info-item:hover {
  background: rgba(255, 255, 255, 0.8);
  transform: translateX(4px);
}

.item-icon {
  font-size: 24px;
  color: #667eea;
  margin-top: 2px;
  flex-shrink: 0;
}

.item-content {
  flex: 1;
  line-height: 1.7;
  font-size: 16px;
  color: #4b5563;
}

.item-content strong {
  color: #1f2937;
  font-weight: 600;
}

/* ç»´åº¦åˆ—è¡¨ */
.dimension-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 24px;
}

.dimension-item {
  display: flex;
  gap: 16px;
  padding: 24px;
  background: rgba(255, 255, 255, 0.6);
  border-radius: 1.5rem;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.dimension-item:hover {
  background: rgba(255, 255, 255, 0.9);
  transform: translateY(-4px);
  border-color: rgba(102, 126, 234, 0.2);
  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.12);
}

.dimension-icon {
  font-size: 40px;
  flex-shrink: 0;
}

.dimension-info h3 {
  font-size: 18px;
  margin-bottom: 8px;
  color: #1f2937;
  font-weight: 700;
}

.dimension-info p {
  font-size: 14px;
  color: #6b7280;
  margin-bottom: 12px;
  line-height: 1.5;
}

.dimension-info :deep(.el-tag) {
  font-weight: 600;
}

/* æç¤ºåˆ—è¡¨ */
.tips-list {
  padding-left: 32px;
  line-height: 2.2;
  margin: 0;
}

.tips-list li {
  color: #4b5563;
  font-size: 16px;
  margin-bottom: 8px;
}

.tips-list li::marker {
  color: #667eea;
}

/* æ“ä½œæŒ‰é’® */
.action-buttons {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 32px;
}

.start-test-btn {
  padding: 18px 56px;
  font-size: 18px;
  font-weight: 600;
  border-radius: 1.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  color: white;
  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
  transition: all 0.3s ease;
}

.start-test-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 32px rgba(102, 126, 234, 0.4);
}

.back-btn {
  padding: 18px 48px;
  font-size: 18px;
  font-weight: 600;
  border-radius: 1.5rem;
  background: white;
  border: 2px solid rgba(102, 126, 234, 0.2);
  color: #667eea;
  transition: all 0.3s ease;
}

.back-btn:hover {
  border-color: #667eea;
  background: rgba(102, 126, 234, 0.05);
  transform: translateY(-3px);
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 1024px) {
  .title {
    font-size: 40px;
  }

  .subtitle {
    font-size: 18px;
  }

  .info-card,
  .dimension-card,
  .tips-card {
    padding: 40px 32px;
  }
}

@media (max-width: 768px) {
  .test-intro-page {
    padding: 40px 16px 32px;
  }

  .title {
    font-size: 32px;
  }

  .subtitle {
    font-size: 16px;
  }

  .intro-header {
    margin-bottom: 40px;
  }

  .info-card,
  .dimension-card,
  .tips-card {
    padding: 32px 24px;
  }

  .card-header {
    font-size: 20px;
  }

  .dimension-list {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .action-buttons {
    flex-direction: column;
  }

  .start-test-btn,
  .back-btn {
    width: 100%;
    padding: 16px;
    font-size: 16px;
  }
}
</style>
